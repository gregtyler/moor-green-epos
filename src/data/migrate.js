const fs = require("fs");

const template = `
{
  "warning": [
    "==================== WARNING ====================",
    "====     Do not edit this file directly      ====",
    "====     It are generated from stock.csv     ====",
    "================================================="
  ],
  "categories": {
    "beer": { "label": "Beer & Cider", "icon": "sports_bar" },
    "wine": { "label": "Wine", "icon": "wine_bar" },
    "spirits": { "label": "Spirits", "icon": "liquor" },
    "soft-drinks": { "label": "Soft Drinks", "icon": "local_drink" },
    "food": { "label": "Food", "icon": "lunch_dining" }
  },
  "items": {
    ##INSERT##
  }
}
`;

const csv = fs.readFileSync(`${__dirname}/stock.csv`).toString();

const jsonRows = csv
  .trim()
  .split("\n")
  .slice(1)
  .map((row) => {
    const [id, label, category, priceInPounds, defaultYN] = row.split(",");
    const priceInPence = parseFloat(priceInPounds) * 100;
    const defaultTF = defaultYN === "Y" ? "true" : "false";

    return `"${id}": { "label": "${label}", "category": "${category}", "price": ${priceInPence}, "defaultView": ${defaultTF} }`;
  });

const complete = template.replace("##INSERT##", jsonRows.join(",\n    "));

fs.writeFileSync(`${__dirname}/stock.json`, complete);
